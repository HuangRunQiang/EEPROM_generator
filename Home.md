# Welcome to the SOES - Simple Open EtherCAT Slave Wiki

This Wiki was created to document the SOES code, and help developpers to create an EtherCAT slave based on the SOES code. The code is written by Arthur Ketels from [SMF Ketels](http://www.smfk.nl), who also wrote the Simple Open EtherCAT master that can be found [here][SOEM]. Installing SOEM on your develoment machine is encouraged as it provides valuable debugging tools to develop your own slave. 
This Wiki is created as part of a project to create a small (in physical size) EtherCAT slave based on the STM32F0. The code can be used on other architectures aswell, hints will be given in the documentation. The development is just starting out, so please be a bit patient on the results. 

## SOES Features
These features are supported by the SOES code:


* Compatible with ET1100, ET1200
* SPI interface
* Maximum mailbox size: 128 bytes
* CoE configuration, Mailbox handling
* Configurable TxPDO, RxPDO
* Easy migration to several platforms:
    * Change CPU initialisation code
    * Change SPI read and write functions
    * if needed, optimize variable space (store constants in flash, settings in EEPROM)
    * No interrupt handling needed for EtherCAT process
* Easy migration to several target application
    * CoE numbering according to ETG5001 (modular device)
### not featured:
* FoE (File Over EtherCAT), EoE (Ethernet over EtherCAT), ...
* DC handling functions; however, if DC is programmed by master, you can use IO between uC and ASIC to trigger actions.
* Digital I/O, 8/16-bit (A)sync uC interface

In general, the idea of the SOES code is that the microcontroller exchanges data with the ESC RAM as often as possible, using a routine that may be interrupted, but does not interrupt itself. Thus, the main activity of the microcontroller can be the time-deterministic acquisistion / output with the 'real world' connected to it, while the EtherCAT process runs in the spare time. For most applications, this approach ensures both time accuracy of the 'core' process of the slave (dealing with the external world) and enough time to deal with EtherCAT. 
The code in the [repository][Repository] was written for an Atmel 'mega' series microcontroller, and then rewritten by the me for the STM32F051. 

## Getting started
* See the useful links below
* Get copies of the most important ETG documents (ETG1000.4, ETG1000.6, ETG2000, ETG5001).
* Get to know your microcontroller; make sure that you can read and write SPI traffic.
* For testing purposes, these tools are provided by Beckhoff
    * Hardware: Piggyback module with ET1100
    * Software: Ethercat configurator, EtherCAT conformance test tool
* To program the EEPROM, install [SOEM]
* Make changes to [cpuinit.c](cpuinit_c) for your microcontroller
* Make changes to [esc_hw.c](esc_hw_c) for your microcontroller
* If custom headers are required for your microcontroller, change those.
* Generate the EEPROM and additional source code with the [online tool found on this website][http://utwente_bss.bitbucket.org/EEPROM_generator.html].
* Write the generated EEPROM file to the ESC (more details in [EEPROM Contents](EEPROM Contents))
* Paste the code generated by the [online tool][EEPROMtool] in objectlist.h and esc.h
* Compile, program the microcontroller, and test if code works (for example using the EtherCAT configurator and Wireshark)

* to create your own application [Change the objectlist](objectlist_h) and [change the main code](soes_c).

## Code repository, useful links
* The code is hosted on bitbucket, [click here for the sources][Repository].
* The code is maintained in a [git](www.git-scm.com) repository. If you want to know more about git, I can recommend [git immersion as a quick start](http://www.gitimmersion.com).
* To use GIT repositories on Windows, [Git Extensions](http://code.google.com/p/gitextensions/) is one of the few (or only?) GUIs to use with GIT.
* Go to [Beckhoff's website](www.beckhoff.com) and the site of the [EtherCAT Technology Group](www.ethercat.org), and register as EtherCAT Technology Group Member to access the documents referred to in this Wiki. The EtherCAT Technology Group maintains the EtherCAT standards, which are the basis of all EtherCAT communication. If you want to create your own slave, you'll have to request a Vendor ID as well.


[Repository]: http://bitbucket.org/utwente_bss/soes_arm
[SOEM]:https://developer.berlios.de/projects/soem/
[EEPROMtool]:EEPROM_generator.html